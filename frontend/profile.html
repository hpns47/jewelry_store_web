<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ü—Ä–æ—Ñ–∏–ª—å - ‚ú® LUXURY</title>
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="navbar">
      <div class="container">
        <div class="nav-brand">‚ú® LUXURY</div>
        <div class="nav-menu">
          <a href="index.html" class="nav-link">–ì–ª–∞–≤–Ω–∞—è</a>
          <a href="catalog.html" class="nav-link">–ö–∞—Ç–∞–ª–æ–≥</a>
          <a href="#" class="nav-link" id="cartLink">
            <span class="cart-icon">üõí</span>
            <span class="cart-count" id="cartCount" style="display: none"
              >0</span
            >
          </a>
          <a href="profile.html" class="nav-link active">üë§ –ü—Ä–æ—Ñ–∏–ª—å</a>
          <a
            href="#"
            class="nav-link"
            onclick="
              logout();
              return false;
            "
            >–í—ã—Ö–æ–¥</a
          >
        </div>
      </div>
    </nav>

    <div class="page-header">
      <h1>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h1>
    </div>

    <div class="container">
      <div class="profile-wrapper">
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è -->
        <div class="profile-card">
          <h2>–õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
          <form onsubmit="updateProfile(event)">
            <div class="form-group">
              <label for="profileName">–ò–º—è</label>
              <input type="text" id="profileName" required />
            </div>
            <div class="form-group">
              <label for="profileEmail">Email (–Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è)</label>
              <input type="email" id="profileEmail" disabled />
            </div>
            <div class="form-group">
              <label for="profilePhone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
              <input type="tel" id="profilePhone" />
            </div>
            <div class="form-group">
              <label for="profileAddress">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</label>
              <input
                type="text"
                id="profileAddress"
                placeholder="–ê–¥—Ä–µ—Å –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏"
              />
            </div>
            <button type="submit" class="btn btn-primary">
              –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
            </button>
          </form>
        </div>

        <!-- –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ -->
        <div class="profile-card">
          <h2>–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h2>
          <div id="ordersList">
            <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
          </div>
        </div>
      </div>
    </div>

    <footer class="footer">
      <div class="container">
        <p>&copy; 2026 ‚ú® LUXURY Jewelry Store. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
      </div>
    </footer>

    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/app.js"></script>
    <script>
      function loadProfile() {
        const user = getUser();
        if (!user) {
          window.location.href = "auth.html";
          return;
        }

        // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å
        API.getProfile(user.id).then((data) => {
          document.getElementById("profileName").value = data.user.name || "";
          document.getElementById("profileEmail").value = data.user.email || "";
          document.getElementById("profilePhone").value = data.user.phone || "";
          document.getElementById("profileAddress").value =
            data.user.address || "";
        });

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–∫–∞–∑—ã
        API.getMyOrders().then((data) => {
          const ordersList = document.getElementById("ordersList");
          if (data.orders.length === 0) {
            ordersList.innerHTML = "<p>–£ –≤–∞—Å –µ—â–µ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤</p>";
            return;
          }

          ordersList.innerHTML = data.orders
            .map(
              (order) => `
          <div class="order-item">
            <div class="order-header">
              <div>
                <strong>–ó–∞–∫–∞–∑ #${order._id.substring(0, 8)}</strong>
                <span class="order-date">${new Date(order.createdAt).toLocaleDateString("ru-RU")}</span>
              </div>
              <span class="order-status status-${order.status}">${getStatusText(order.status)}</span>
            </div>
            <div class="order-items">
              ${order.items
                .map(
                  (item) => `
                <p>${item.jewelryId.name} √ó ${item.quantity} = ${item.quantity * item.price} ‚ÇΩ</p>
              `,
                )
                .join("")}
            </div>
            <div class="order-footer">
              <strong>–ò—Ç–æ–≥–æ: ${order.totalPrice} ‚ÇΩ</strong>
              ${order.status === "pending" ? `<button class="btn btn-danger btn-small" onclick="cancelOrder('${order._id}')">–û—Ç–º–µ–Ω–∏—Ç—å</button>` : ""}
            </div>
          </div>
        `,
            )
            .join("");
        });
      }

      function getStatusText(status) {
        const statuses = {
          pending: "‚è≥ –í –æ–∂–∏–¥–∞–Ω–∏–∏ –æ–ø–ª–∞—Ç—ã",
          paid: "‚úì –û–ø–ª–∞—á–µ–Ω–æ",
          shipped: "üì¶ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ",
          delivered: "‚úì –î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ",
          cancelled: "‚úó –û—Ç–º–µ–Ω–µ–Ω–æ",
        };
        return statuses[status] || status;
      }

      function cancelOrder(orderId) {
        if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑?")) {
          API.cancelOrder(orderId)
            .then(() => {
              showNotification("–ó–∞–∫–∞–∑ –æ—Ç–º–µ–Ω–µ–Ω");
              loadProfile();
            })
            .catch((err) => showNotification(err, "error"));
        }
      }

      loadProfile();
    </script>
  </body>
</html>
