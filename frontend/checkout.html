<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ - ‚ú® LUXURY</title>
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="navbar">
      <div class="container">
        <div class="nav-brand">‚ú® LUXURY</div>
        <div class="nav-menu">
          <a href="index.html" class="nav-link">–ì–ª–∞–≤–Ω–∞—è</a>
          <a href="catalog.html" class="nav-link">–ö–∞—Ç–∞–ª–æ–≥</a>
          <a href="#" class="nav-link" id="cartLink">
            <span class="cart-icon">üõí</span>
            <span class="cart-count" id="cartCount" style="display: none"
              >0</span
            >
          </a>
          <a href="profile.html" class="nav-link">üë§ –ü—Ä–æ—Ñ–∏–ª—å</a>
          <a
            href="#"
            class="nav-link"
            onclick="
              logout();
              return false;
            "
            >–í—ã—Ö–æ–¥</a
          >
        </div>
      </div>
    </nav>

    <div class="page-header">
      <h1>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h1>
    </div>

    <div class="container">
      <div class="checkout-wrapper">
        <!-- –§–æ—Ä–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è -->
        <div class="checkout-form">
          <h2>–í–∞—à–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
          <form onsubmit="submitOrder(event)">
            <div class="form-section">
              <h3>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</h3>
              <div class="form-group">
                <label for="shippingAddress">–ê–¥—Ä–µ—Å</label>
                <input
                  type="text"
                  id="shippingAddress"
                  required
                  placeholder="—É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, –¥. 1"
                />
              </div>
            </div>

            <div class="form-section">
              <h3>–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</h3>
              <label class="radio-group">
                <input type="radio" name="paymentMethod" value="card" checked />
                <span>üí≥ –ö–∞—Ä—Ç–∞ (Visa/MasterCard)</span>
              </label>
              <label class="radio-group">
                <input
                  type="radio"
                  name="paymentMethod"
                  value="bank_transfer"
                />
                <span>üè¶ –ë–∞–Ω–∫–æ–≤—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥</span>
              </label>
              <label class="radio-group">
                <input type="radio" name="paymentMethod" value="cash" />
                <span>üí∞ –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏</span>
              </label>
            </div>

            <div class="form-section">
              <h3>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</h3>
              <div class="form-group">
                <label for="notes">–ó–∞–º–µ—Ç–∫–∏ –∫ –∑–∞–∫–∞–∑—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                <textarea
                  id="notes"
                  rows="3"
                  placeholder="–í–∞—à–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è..."
                ></textarea>
              </div>
            </div>

            <button type="submit" class="btn btn-primary btn-block btn-lg">
              –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
            </button>
          </form>
        </div>

        <!-- –°–≤–æ–¥–∫–∞ –∑–∞–∫–∞–∑–∞ -->
        <div class="checkout-summary">
          <h2>–°–≤–æ–¥–∫–∞ –∑–∞–∫–∞–∑–∞</h2>
          <div id="cartSummary">
            <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JS -->
          </div>
        </div>
      </div>
    </div>

    <footer class="footer">
      <div class="container">
        <p>&copy; 2026 ‚ú® LUXURY Jewelry Store. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
      </div>
    </footer>

    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/app.js"></script>
    <script>
      function loadCheckout() {
        const user = getUser();
        if (!user) {
          window.location.href = "auth.html";
          return;
        }

        const cart = getCart();
        if (cart.length === 0) {
          document.querySelector(".checkout-wrapper").innerHTML = `
          <div class="empty-state">
            <h2>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</h2>
            <p>–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –ø–µ—Ä–µ–¥ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º –∑–∞–∫–∞–∑–∞</p>
            <a href="catalog.html" class="btn btn-primary">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥</a>
          </div>
        `;
          return;
        }

        // –ó–∞–ø–æ–ª–Ω—è–µ–º –∞–¥—Ä–µ—Å –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è
        API.getProfile(user.id).then((data) => {
          if (data.user.address) {
            document.getElementById("shippingAddress").value =
              data.user.address;
          }
        });

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–≤–æ–¥–∫—É –∑–∞–∫–∞–∑–∞
        const summary = document.getElementById("cartSummary");
        let total = 0;
        let html = '<div class="cart-items">';

        cart.forEach((item) => {
          total += item.price * item.quantity;
          html += `
          <div class="cart-item">
            <div class="item-info">
              <strong>${item.name}</strong>
              <span class="item-qty">√ó ${item.quantity}</span>
            </div>
            <span class="item-price">${item.price * item.quantity} ‚ÇΩ</span>
          </div>
        `;
        });

        html += `
        </div>
        <div class="order-total">
          <p>–°—É–º–º–∞: <strong>${total} ‚ÇΩ</strong></p>
          <p>–î–æ—Å—Ç–∞–≤–∫–∞: <strong>–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</strong></p>
          <p class="total-price">–ò–¢–û–ì–û: <strong>${total} ‚ÇΩ</strong></p>
        </div>
      `;

        summary.innerHTML = html;
      }

      function submitOrder(e) {
        e.preventDefault();

        const cart = getCart();
        if (cart.length === 0) {
          showNotification("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞", "error");
          return;
        }

        const orderData = {
          items: cart.map((item) => ({
            jewelryId: item.id,
            quantity: item.quantity,
          })),
          paymentMethod: document.querySelector(
            'input[name="paymentMethod"]:checked',
          ).value,
          shippingAddress: document.getElementById("shippingAddress").value,
          notes: document.getElementById("notes").value,
        };

        API.createOrder(orderData)
          .then((data) => {
            clearCart();
            showNotification("‚úì –ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ!");
            setTimeout(() => {
              window.location.href = "profile.html";
            }, 1500);
          })
          .catch((err) => {
            showNotification(err, "error");
          });
      }

      loadCheckout();
    </script>
  </body>
</html>
